#!/bin/bash

echo "Remember to run me *after* changing version in _config.yml"
sleep 1

BUILDLIST=(
	util.js
	class.js
	event.js
	base.js
	model.js
	collection.js
	adapter.js
	controller.js
	listcontroller.js
	router.js
	relational.js
	filtercollection.js
);

echo -n '' > composer.js
for file in "${BUILDLIST[@]}"; do
	cat src/$file >> composer.js
done

VERSION=$(cat _config.yml | grep 'version:' | sed 's|.*: \+||')
echo "Setting version => ${VERSION}"
sed -i "s|version: 'GITHEAD'|version: '${VERSION}'|" composer.js

read -r -d '' COPYRIGHT <<EOFLOL
/*
 * Copyright (c) 2011, Lyon Bros Enterprises, LLC. (http://www.lyonbros.com)
 *
 * Licensed under The MIT License.
 * Redistributions of files must retain the above copyright notice.
 */
EOFLOL

echo -n "$COPYRIGHT" > composer.min.js
cat composer.js | jsmin >> composer.min.js

echo "Done building composer.js / composer.min.js"

